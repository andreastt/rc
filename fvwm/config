# Virtual desktops
DesktopSize 3x3
EdgeScroll 100 100
EdgeMoveDelay 150
EdgeMoveResistance 150
EdgeThickness 1

# Allow IPC calls to this fvwm session
Module FvwmCommandS

Style * GrabFocusOff

# SmartPlacement makes new windows pop-up in blank regions of screen.  If
# SmartPlacement fails, RandomPlacement places it randomly instead of making
# you do it.
Style * SmartPlacement
Style * RandomPlacement

# Mouse and focus behaviour
ClickTime 750
MoveThreshold 3
Style * SloppyFocus, MouseFocusClickRaises

# Window switcher
InfoStoreAdd DIR Next

OpaqueMoveSize -1
Emulate MWM
HideGeometryWindow Always
SnapAttraction 5 SameType Screen
SnapGrid 3 3
XorValue 55555
Style * DecorateTransient, DontRaiseTransient
Style * DontLowerTransient, StackTransientParent
Style * GrabFocusTransientOff
Style * WindowShadeSteps 20, WindowShadeScrolls
SetAnimation 10 -.01 0 .01 .03 .08 .18 .3 .45 .6 .75 .85 .90 .94 .97 .99 1.0
Style * MwmDecor, SlipperyIcon
Style * IconBox 0 -10 -280 -1

# Border styling
Style	*	NoTitle, BorderWidth 3, HandleWidth 4
Style	*	SnapAttraction 20 SameType Screen
BorderStyle	Active Solid SteelBlue4 -- NoInset HiddenHandles
BorderStyle	Inactive Solid #11236b -- NoInset HiddenHandles

# Styles for various Fvwm modules:
Style Fvwm*       NoTitle,  Sticky, WindowListSkip
Style Fvwm*       BorderWidth 2, CirculateSkipIcon, CirculateSkip
Style FvwmPager   StaysOnTop
Style FvwmBanner  StaysOnTop
Style FvwmButtons Icon toolbox.xpm, ClickToFocus

Style	*	IconFont	"xft:Lucida Sans:size=10"
MenuStyle	*	Font		"xft:Lucida Sans:size=10"
MenuStyle	*	Foreground black, Background gainsboro, Greyed grey40

# Style specific to programs 
Style "xload"	NoTitle, Sticky, WindowListSkip, ClickToFocus
Style "Fvwm*"	NoTitle, Sticky, WindowListSkip
Style "xterm"	HandleWidth 3, HilightFore yellow, HilightBack red

DestroyFunc InitFunction
AddToFunc InitFunction
	+ I Exec xset -b
	+ I Exec xrdb -merge .Xresources
	+ I Exec xbindkeys -f .xbindkeysrc
	+ I Exec xscreensaver -no-splash
	+ I Exec redshift
	+ I Module FvwmAnimate
	+ I Module FvwmDebug --log /var/log/fvwm --events --xconsole -d7

DestroyFunc StartFunction
AddToFunc StartFunction
	+ I Exec xinput set-int-prop "TPPS/2 IBM TrackPoint" "Evdev Wheel Emulation" 8 1
	+ I Exec xinput set-int-prop "TPPS/2 IBM TrackPoint" "Evdev Wheel Emulation Button" 8 2
	+ I Exec xinput set-int-prop "TPPS/2 IBM TrackPoint" "Evdev Wheel Emulation Axes" 8 6 7 4 5
	+ I Exec xrandr --dpi 96
	+ I Exec pgrep compton || compton -b -cCGfF -o 0.10 -O1 -I1 -t3 -l -15 -r8 --backend glx
	+ I Exec xmodmap .Xmodmap

DestroyFunc SelectWindow
AddToFunc SelectWindow
	+ I Focus
	+ I Iconify false
	+ I Raise
	+ I WarpToWindow 50 17p

DestroyFunc Urxvt
AddToFunc Urxvt
	+ I Exec exec urxvt
	+ I Wait urxvt
	+ I Next (urxvt) WarpToWindow 50 17p

DestroyFunc FirefoxWindow
AddToFunc FirefoxWindow
	+ I Exec exec firefox -new-window
	+ I Wait firefox
	+ I Next (firefox) WarpToWindow 50 17p

DestroyFunc Run
AddToFunc Run
	+ I Exec exec $(zenity --entry --text "Run command:")
	+ I Wait zenity
	+ I Next (zenity) WarpToWindow 50 17p

DestroyFunc FuncSwitchWindow
AddToFunc FuncSwitchWindow
  + I $[infostore.DIR] (CurrentPage, AcceptsFocus, !Shaded !Iconic, !Sticky) SelectWindow
  + I Deschedule 134000
  + I PipeRead `[ "$[infostore.DIR]" == "Prev" ] && \
                echo 'InfoStoreAdd NDIR Next' || \
                echo 'InfoStoreAdd NDIR Prev'`
  + I Schedule 700 134000 InfoStoreAdd DIR $[infostore.NDIR]

DestroyFunc CloseWindow
AddToFunc CloseWindow
  + I Close
  + I Previous WarpToWindow 50 17p

AddToFunc SwitchWindow
  + I $[DIR] (CurrentPage, !Iconic, !Sticky) FocusRaiseAndStuff
  + I Deschedule 134000
  + I PipeRead `[ "$[DIR]" == "Prev" ] &amp;&amp; \
      echo 'SetEnv NDIR Next' || \
      echo 'SetEnv NDIR Prev'`
  + I Schedule 700 134000 SetEnv DIR $[NDIR]

DestroyFunc Thumbnail
AddToFunc Thumbnail
  + I Raise
  + I ThisWindow (!Shaded, Iconifiable, !Iconic) PipeRead \
      "xwd -silent -id $[w.id] | convert -scale 128 -frame 1x1 \
      -mattecolor black -quality 0 xwd:- \
      png:/tmp/icon.tmp.$[w.id].png && \
      echo WindowStyle IconOverride, \
      Icon /tmp/icon.tmp.$[w.id].png || \
      echo Nop"
  + I Iconify

DestroyFunc DeThumbnail
AddToFunc DeThumbnail
	+ I Exec rm -f /tmp/icon.tmp.$[w.id].png
	+ I DestroyWindowStyle

*FvwmEvent: deiconify DeThumbnail

AddToFunc StartFunction I Test (Restart) All (Iconic) \
  Test (f /tmp/icon.tmp.$[w.id].png) WindowStyle \
  IconOverride, Icon /tmp/icon.tmp.$[w.id].png

DestroyFunc ExitFunction
  AddToFunc ExitFunction I Test (!ToRestart) \
  Exec rm -f /tmp/icon.tmp.*

DestroyFunc RootScreenshot
AddToFunc RootScreenshot
+ I Exec xwd -root | convert xwd:- $HOME/Desktop/screenshot-`date +%F-%H%M%S`.png

DestroyFunc WindowScreenshot
AddToFunc WindowScreenshot
+ I ThisWindow (!Shaded !Iconic Iconifiable) \
  Exec xwd -frame -id $[w.id] | convert xwd:- $HOME/Desktop/screenshot-`date +%F-%H%M%S`.png

#####################################
# Key bindings
#####################################

# Ignore NumLock key
IgnoreModifiers L25

# Super-Return gives you a new X terminal
Key Return A 4 Urxvt

# Super-d runs dmenu
Key d A 4 Exec exec dmenu_run

# Super-c closes window
Key c A 4 CloseWindow

# S-Super-r and S-Super-e to restart and quit fvwm
Key r A 4S Restart
Key e A 4S Quit

# Go to page with Super-{0,1,2,3,4,5,6,7,8,9}
Key 1 A 4 GotoPage 0 0
Key 2 A 4 GotoPage 1 0
Key 3 A 4 GotoPage 2 0
Key 4 A 4 GotoPage 0 1
Key 5 A 4 GotoPage 1 1
Key 6 A 4 GotoPage 2 1
Key 7 A 4 GotoPage 0 2
Key 8 A 4 GotoPage 1 2
Key 9 A 4 GotoPage 2 2

# Move window to page with S-Super-{0,1,2,3,4,5,6,7,8,9}
Key 1 FSTW 4S MoveToPage 0 0
Key 2 FSTW 4S MoveToPage 1 0
Key 3 FSTW 4S MoveToPage 2 0
Key 4 FSTW 4S MoveToPage 0 1
Key 5 FSTW 4S MoveToPage 1 1
Key 6 FSTW 4S MoveToPage 2 1
Key 7 FSTW 4S MoveToPage 0 2
Key 8 FSTW 4S MoveToPage 1 2
Key 9 FSTW 4S MoveToPage 2 2

# Go to page with C-{Left,Up,Down,Right} arrow keys
Key Down  A C GotoPage  0p +1p
Key Up    A C GotoPage  0p -1p
Key Right A C GotoPage +1p  0p
Key Left  A C GotoPage -1p  0p

# Move focused window to another page with C-S-{Left,Right,Down,Right} arrow keys
Key Down  A CS MoveToPage  0p +1p
Key Up    A CS MoveToPage  0p -1p
Key Right A CS MoveToPage +1p  0p
Key Left  A CS MoveToPage -1p  0p

# M-Tab opens window switcher
Key Tab A 4  FuncSwitchWindow

# Press arrow + meta + control anywhere, move window focus in that direction
Key Left	A	4	Direction West	(CurrentPage) SelectWindow
Key Right	A	4	Direction East	(CurrentPage) SelectWindow
Key Up	A	4		Direction North	(CurrentPage) SelectWindow
Key Down	A	4	Direction South	(CurrentPage) SelectWindow

# Lock screen with Super-l
Key l A 4 Exec exec xscreensaver-command -lock

# Maximize window with C-Super-Space
Key space W 4C Maximize grow grow

# Vertically maximize/grow window with C-Super-Up and C-Super-Down
Key Up A 4C Maximize 0 grow
Key Down A 4C Maximize 0 grow

# Horizontally maximize/grow window with C-Super-Left and
# C-Super-Right
Key Left A 4C Maximize grow 0
Key Right A 4C Maximize grow 0



# some simple default key bindings:
Key Next         A       SCM     Next [*] Focus
Key Prior        A       SCM     Prev [*] Focus

# Iconify window with S-z
Key Z FSTW 4 Thumbnail

# Root window
Mouse	1	R	A	Menu MenuFvwmRoot Nop
Mouse	2	R	A	Menu MenuFvwmWindowOps Nop
Mouse	3	R	A	WindowList NoGeometry, NoCurrentDeskTitle
Mouse	8	R	A	WindowList NoGeometry, NoCurrentDeskTitle
Mouse	10	R	A	Menu MenuFvwmWindowOps Nop

# Title bar buttons
Mouse	0	1       A       Menu MenuFvwmWindowOps2 Close
Mouse	0	2       A       FuncFvwmMaximize
Mouse	0	4       A       Thumbnail

# Mouse-grab with Super for various window operations, click anywhere
# on a window
Mouse	1	FSTW	M	WindowLeftClick
Mouse	2	FSTW	M	Thumbnail
Mouse	3	FSTW	M	RaiseAndResize

# Move window with Super-{button 1} and resize with Super-{button 3}
Mouse	1	FSTW	4	FuncFvwmMoveOrRaise
Mouse	2	FSTW	4	FuncFvwmResizeOrRaise
Mouse	3	FSTW	4	FuncFvwmResizeOrRaise

# Shades and unshades active window
Mouse	4	T	A	FvwmWindowShade True
Mouse	5	T	A	FvwmWindowShade False

# Resize the thumbnail
Mouse 1 I N DeThumbnail

#   for other parts of the window/borders/icons:
Mouse 1		F	A	FuncFvwmResizeOrRaise
Mouse 1		TS	A	FuncFvwmMoveOrRaise
Mouse 1		I	A	FuncFvwmMoveOrIconify
Mouse 2		I	A	Thumbnail
Mouse 2		FST	A	Menu MenuFvwmWindowOps2 Nop
Mouse 3		TSIF	A	RaiseLower
Mouse 8		WTSIF	A	WindowList NoGeometry, NoCurrentDeskTitle
Mouse 10	WTSIF	A	Menu MenuFvwmWindowOps Nop

######################## Menus ###################
# Make sure that the Debian menus, and the icons they reference, are
# available
ImagePath /usr/share/icons:/usr/share/pixmaps:/usr/share/icons/wm-icons:+
ImagePath +:/usr/X11R6/include/X11/pixmaps/:/usr/X11R6/include/X11/bitmaps/
ImagePath +:/usr/include/X11/bitmaps/
Read /etc/X11/fvwm/menudefs.hook Quiet
Read menudefs.hook Quiet

DestroyMenu MenuFvwmRoot
AddToMenu MenuFvwmRoot
	+ "&Terminal"				Urxvt
	+ "Fi&le manager"			Exec exec nautilus -w $HOME
	+ ""					Nop
	+ "&Firefox" 				Exec exec firefox -new-window
	+ "Firefox (&private)"			Exec exec firefox -private-window
	+ "Other &browsers"			Popup MenuBrowsers
	+ "&acme"				Exec exec $HOME/bin/acme.rc -l $HOME/acme.dump
	+ "acm&e@tristan"			Exec exec ssh -Y tristan '$HOME/bin/acme.rc -l $HOME/acme.dump'
	+ "&Mail"				Exec exec astroid
	+ "&Calendar"				Exec exec gnome-calendar
	+ "C&ontacts"				Exec exec gnome-contacts
	+ "&Spotify"				Exec exec spotify
	+ "P&hotos"				Exec exec shotwell
	+ "&Games"				Popup MenuGames
	+ ""					Nop
	+ "&Run command…"			Run
	+ ""					Nop
	+ "$[gt.Remote log&ins]"		Popup MenuFvwmLogins
	+ "$[gt.&Utilities]"			Popup MenuFvwmUtilities
	+ ""					Nop
	+ "Lock screen"				Exec exec xscreensaver-command -lock
	+ "$[gt.fv&wm]"				Popup MenuFvwm

DestroyMenu MenuBrowsers
AddToMenu MenuBrowsers
	+ "&Chrome"		Exec exec google-chrome
	+ "Chrome &incognito"	Exec exec google-chrome --incognito

DestroyMenu MenuGames
AddToMenu MenuGames
	+ "&Stardew Valley"	Exec exec $HOME/Games/Stardew\ Valley/start.sh
	+ "&Wesnoth"		Exec exec wesnoth

DestroyMenu MenuFvwmUtilities
AddToMenu MenuFvwmUtilities
	+ "&Arandr"			Exec exec arandr
	+ "&IceCC monitor"		Exec exec icemon
	+ "&Kill…"			Exec exec xkill
	+ "&Font viewer"		Exec exec gnome-font-viewer
	+ "&Package manager"		Exec exec gksudo synaptic
	+ "&System monitor"		Exec exec gnome-system-monitor
	+ "System &logs"		Exec exec gnome-system-log
	+ "P&ower statistics"		Exec exec gnome-power-statistics
	+ "&Top"			Exec exec urxvt -T Top -n Top -e top
	+ "&Volume control"		Exec exec pavucontrol
	+ "&Wicd"			Exec exec wicd-gtk
	+ "Calc&ulator"			Exec exec gnome-calculator
	+ "&Disk usage space analyzer"	Exec exec baobab
	+ ""				Nop
	+ "&D. $[gt.Reset X defaults]"	Exec xrdb -load $HOME/.Xdefaults

# The window Ops menus exhibit a different HotKey style.
# There are 2 versions of the WindowOps Menu, meant to be bound to different
# things.  Here is the "common" part:
DestroyFunc FuncFvwmWindowCommon
AddToFunc FuncFvwmWindowCommon
+ I AddToMenu $0 "$[gt.(De)&Iconify]"         Thumbnail
+ I AddToMenu $0 "$[gt.&Move]"                Move
+ I AddToMenu $0 "$[gt.&Resize]"              Resize
+ I AddToMenu $0 "$[gt.R&aise]"               Raise
+ I AddToMenu $0 "$[gt.&Lower]"               Lower
+ I AddToMenu $0 "$[gt.(Un)&Stick]"           Stick
+ I AddToMenu $0 "$[gt.(Un)Ma&ximize]"        Maximize
+ I AddToMenu $0 "$[gt.(Un)&Grow vertically]" Maximize 0 grow
+ I AddToMenu $0 ""                 Nop
+ I AddToMenu $0 "$[gt.&Delete]"              Delete
+ I AddToMenu $0 "$[gt.&Close]"               Close
+ I AddToMenu $0 "$[gt.Destroy]"              Destroy
+ I AddToMenu $0 ""                 Nop

# First windowops menu, bound to:
# mouse 2 on root
# Root menu
DestroyMenu MenuFvwmWindowOps
FuncFvwmWindowCommon MenuFvwmWindowOps
+ "$[gt.Take screens&hot]" RootScreenshot

# Second windowops menu, bound to:
# any mouse on titlebar button 1
# mouse 2 on frame, side or titlebar
DestroyMenu MenuFvwmWindowOps2
AddToMenu MenuFvwmWindowOps2
FuncFvwmWindowCommon MenuFvwmWindowOps2
+ "$[gt.Take screens&hot]" WindowScreenshot

DestroyFunc FuncFvwmRloginUrxvt
AddToFunc FuncFvwmRloginUrxvt \
  I Exec urxvt -name $0 -title "$USER @ $0" -e rlogin -Y $0

DestroyMenu MenuFvwmLogins
AddToMenu MenuFvwmLogins
+ &eir		FuncFvwmRLoginUrxvt eir
+ &sny.no	FuncFvwmRloginUrxvt sny.no
+ &tristan	FuncFvwmRLoginUrxvt tristan

DestroyMenu MenuFvwmModules
AddToMenu MenuFvwmModules "$[gt.Fvwm Modules]"        Title
+ "&1. $[gt.Control Animation]" Popup  MenuFvwmAnimate
+ "&B. Button-Bar"        Module FvwmButtons
+ "&O. IconBox"           FuncFvwmConfigureIconBox
+ "&F. Forms"             Popup  MenuFvwmForms
+ "&I. Identify"          Module FvwmIdent
+ "&M. IconMan"           Module FvwmIconMan
+ "&N. Banner"            Module FvwmBanner
+ "&C. Console"           Module FvwmConsole
+ "&P. Pager"             Module FvwmPager 0 0
+ "&2. Pager (2 $[gt.desks])"   Module FvwmPager 0 1
+ "&R. Backer"            Module FvwmBacker
+ "&S. ScrollBar"         Module FvwmScroll 50 50
+ "&T. FvwmTaskBar"       Module FvwmTaskBar
+ "&U. AutoRaise"         Module FvwmAuto 200 Raise Nop
+ "&W. WinList"           Module FvwmWinList

DestroyMenu MenuFvwmForms
AddToMenu MenuFvwmForms
+ "&C. Capture"       Module FvwmForm FvwmForm-Capture
+ "&D. Form Defaults" Module FvwmForm FvwmForm-Form
+ "&R. Rlogin"        Module FvwmForm FvwmForm-Rlogin
+ "&P. RootCursor"    Module FvwmForm FvwmForm-RootCursor
+ "&S. Setup"         Module FvwmForm FvwmForm-Setup
+ "&T. Talk Form"     Module FvwmForm FvwmForm-Talk
+ "&Q. QuitVerify"    Module FvwmForm FvwmForm-QuitVerify

# Configure and start using an iconbox on the fly
DestroyFunc FuncFvwmConfigureIconBox
AddToFunc FuncFvwmConfigureIconBox
+ I Module FvwmIconBox
+ I Style     *  NoIcon

DestroyMenu MenuFvwm
AddToMenu MenuFvwm
+ "&Q. $[gt.Quit]" Quit
+ "&R. $[gt.Restart]"          Restart
+ ""                     Nop
+ "&N. $[gt.No, Don't Quit]"   Nop

DestroyFunc FuncFvwmMoveOrRaise
AddToFunc FuncFvwmMoveOrRaise
+ I Raise
+ M Move
+ D Lower

DestroyFunc FuncFvwmMaximize
AddToFunc FuncFvwmMaximize
+ M Maximize   0 100
+ H Maximize   0 100
+ C Maximize   0  80
+ D Maximize 100 100

DestroyFunc FuncFvwmMoveOrIconify
AddToFunc FuncFvwmMoveOrIconify
+ I Raise
+ M Move
+ D Thumbnail

DestroyFunc FuncFvwmResizeOrRaise
AddToFunc FuncFvwmResizeOrRaise
+ I Raise
+ M Resize
+ D Lower

DestroyFunc FuncFvwmFocusPolicyChange
AddToFunc FuncFvwmFocusPolicyChange
+ I Style * $0
+ I Recapture

# Read config files for modules:
read ConfigFvwmButtons
