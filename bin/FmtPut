#!/bin/zsh

# Format window's body using a formatter tied to its file ending
# (tag with filename and extension must be present) and save it to
# disk.

tagarray=($(9p read acme/$winid/tag))
file=$tagarray[1]
ext=$(echo -n "$file" | grep -oE '\.([a-z]{1,3})$')
if [[ -z $ext ]]; then
	echo "unable to find file name"
	exit 1
fi

cmd="unknown"
if [[ $ext == ".py" ]]; then cmd=pyfmt
elif [[ $ext == ".go" ]]; then cmd=gofmt
else
	echo "unknown formatter for file extension: $ext"
	exit 1
fi

echo -n , | 9p write acme/$winid/addr
9p read acme/$winid/body | $cmd | 9p write acme/$winid/data
echo -n 'put' | 9p write acme/$winid/ctl
